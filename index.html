<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>ArcPy Scripting Techniques</title>

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/moon.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section data-markdown="">
                    <script type="text/template">
                        ## ArcPy Scripting Techniques

                        ### [Shane Buscher](https://www.linkedin.com/in/shanebuscher)
                        ### [Velosys](http://www.velosys.com)
                    </script>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## About

                        * GIS application developer
                        * HTML5, .NET, Python, SQL
                        * ArcGIS JavaScript, ArcGIS Runtime, ArcPy
                        * Diversified LOB apps
                    </script>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## Presentation Availability

                        [https://sbuscher.github.io/arcpy-scripting-presentation](https://sbuscher.github.io/arcpy-scripting-presentation)
                        [GitHub Repository](https://github.com/sbuscher/arcpy-scripting-presentation/tree/gh-pages)
                    </script>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## Goals

                        * Address what isn't covered by samples
                        * Learn Python and ArcPy best practices
                        * Develop, debug, organize and maintain scripts
                        * Minimal Python and ArcPy experience required
                    </script>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## The Case for ArcPy Scripting

                        * Eliminate manual and repetitive GP tasks
                        * Leverage functionality not exposed by GP tools
                        * Create toolboxes for use in ArcGIS Desktop and Server

                        Note:
                        Refresh data
                        Convert vendor data to usable formats and import
                        Publish services
                        Run a custom update cursor to modify data
                    </script>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## The Case for Python

                        Free | Open Source | Cross-platform

                        Widely adopted

                        Friendly to beginners and powerful for experts

                        > "It is interpreted and dynamically typed and is suited for interactive work and quick prototyping of one-off programs known as scripts while being powerful enough to write large applications in." [ESRI](http://pro.arcgis.com/en/pro-app/arcpy/get-started/what-is-arcpy-.htm)

                        Note:
                        Used in Big Data, Data Science, AI
                    </script>
                </section>
                <section>
                    <section data-markdown>
                        <script type="text/template">
                            ## Essentials

                            * At a minimum:
                                * ArcGIS Desktop or Pro --> Python and ArcPy
                                * ArcPy and Python reference documentation
                                * Text editor
                            * Recommend:
                                * Integrated Development Environment (IDE)
                                * Source control
                        </script>
                    </section>
                    <section data-markdown>
                        <script type="text/template">
                            ## ArcGIS Desktop Setup

                            * Desktop installer includes 32-bit & 64-bit Python
                                * 32-bit is installed by default
                                * [Background Geoprocessing](http://desktop.arcgis.com/en/arcmap/latest/analyze/executing-tools/64bit-background.htm) optional
                            * Python 2.7
                            * Default install: *C:\Python27*

                            Note:
                            Show Python 32 and 64 bit directories, site-packages, .pth to arcpy,
                            Show where ArcPy lib resides: C:\Program Files (x86)\ArcGIS\Desktop10.3\arcpy
                            Note ..\site-packages\DTBGGP64.pth references arcpy
                        </script>
                    </section>
                    <section data-markdown>
                        <script type="text/template">
                            ## ArcGIS Pro

                            * 64-bit | Python 3.5 | [Conda](http://pro.arcgis.com/en/pro-app/arcpy/get-started/what-is-conda.htm) package manager
                            * *C:\Program Files\ArcGIS\Pro\bin\Python*
                            * [Python in ArcGIS Pro](http://pro.arcgis.com/en/pro-app/arcpy/get-started/installing-python-for-arcgis-pro.htm)
                            * [Migrating to ArcGIS Pro](http://pro.arcgis.com/en/pro-app/arcpy/get-started/python-migration-for-arcgis-pro.htm)

                            Note:
                            Show Python directory: C:\Program Files\ArcGIS\Pro\bin\Python
                            Show ArcPy lib directory: C:\Program Files\ArcGIS\Pro\Resources\ArcPy
                        </script>
                    </section>
                    <section data-markdown>
                        <script type="text/template">
                            ## Reference documentation

                            * ArcGIS Desktop
                                * [ArcGIS Desktop ArcPy Reference](http://desktop.arcgis.com/en/arcmap/10.3/analyze/arcpy/what-is-arcpy-.htm)
                                * [ArcGIS Desktop Tool Reference](http://desktop.arcgis.com/en/arcmap/10.3/main/tools/a-quick-tour-of-geoprocessing-tool-references.htm)
                                * [Python 2.7 Docs](https://docs.python.org/2/)
                            * ArcGIS Pro
                                * [ArcGIS Pro ArcPy Reference](http://pro.arcgis.com/en/pro-app/arcpy/main/arcgis-pro-arcpy-reference.htm)
                                * [ArcGIS Pro Tool Reference](http://pro.arcgis.com/en/pro-app/tool-reference/main/arcgis-pro-tool-reference.htm)
                                * [Python 3.4 Docs](https://docs.python.org/3.4/)
                            * [GeoNet](https://geonet.esri.com/community/developers/gis-developers/python/content) Python Community
                            * [PEP8](https://www.python.org/dev/peps/pep-0008/) Python style guide
                        </script>
                    </section>
                    <section data-markdown>
                        <script type="text/template">
                            ## Python Code Editors

                            * Main features to look for in an IDE:
                                * Code completion
                                * Syntax and error highlighting
                                * Debugging
                            * [PyCharm Community Edition](https://www.jetbrains.com/pycharm/download/#section=windows)

                            Note:
                            IDLE comes with Desktop/Pro
                            [How to set up an IDE to use in Anaconda](https://docs.continuum.io/anaconda/ide_integration)
                            [Choosing the Right Python IDE](https://blogs.esri.com/esri/arcgis/2013/06/24/choosing-the-right-python-integrated-development-environment/)
                        </script>
                    </section>
                    <section data-markdown>
                        <script type="text/template">
                            ## Source control

                            * Keep your code safe
                            * Compare (diff) your changes
                            * Restore a previous version
                            * Separate new features with branches
                            * [GitHub](http://www.github.com) | [ESRI GitHub Python Repositories](https://github.com/Esri?utf8=%E2%9C%93&q=&type=&language=python)
                        </script>
                    </section>
                </section>
                <section>
                    <section data-markdown>
                        <script type="text/template">
                            ## The Python Interactive Window
                        </script>
                    </section>
                    <section data-markdown>
                        <script type="text/template">
                            ## ArcGIS Desktop and Pro

                            ![Python window](../img/arcgis-py-window.png) <!-- .element height="75% width="75%" -->

                            Note:
                            Use TourDivide.mxd
                            Run an arcpy function in Desktop
                            Run a tool in Pro
                                count = arcpy.GetCount_management("Route")
                                Explain that you get a Result object
                                Cast to int
                            arcpy already imported
                            show code completion and note layers and mxd already referenced
                        </script>
                    </section>
                    <section data-markdown>
                        <script type="text/template">
                            ## Demo: Desktop Interactive Window

                            TourDivide.mxd

                            ```
                            # Run a tool
                            result = arcpy.GetCount_management("Route")
                            count = int(result.getOutput(0))
                            ```
                            ```
                            # Run a function
                            mxd = arcpy.mapping.MapDocument("CURRENT")
                            arcpy.mapping.ExportToPDF(mxd, r"c:\Temp\TourDivide.pdf")
                            ```
                            Note:
                            arcpy already imported
                        </script>
                    </section>
                    <section data-markdown>
                        <script type="text/template">
                            ## Demo: Pro Interactive Window

                            TourDivide.aprx
                            ```
                            # Create PDF the Pro way
                            from arcpy import mp
                            aprx = mp.ArcGISProject("CURRENT")
                            layout = aprx.listLayouts()[0]
                            layout.exportToPDF(arcpy.env.scratchFolder + r"TourDividePro.pdf")
                            ```
                            ```
                            # Create lines from points
                            arcpy.env.workspace = r"C:\projects\arcpy-scripting-presentation\data\gdb\TourDivide.gdb"
                            arcpy.PointsToLine_management("Route", "Trail")
                            aprx.save()
                            ```
                        </script>
                    </section>
                    <section data-markdown>
                        <script type="text/template">
                            ## At The Command Prompt

                            * Desktop and Pro know python.exe location
                            * Configure python.exe to execute globally
                            * Add python.exe to your PATH environment variable
                            * Choose between 2.7 and 3.5

                            ```
                            C:\Temp> python
                            Python 2.7.8 (default, Jun 30 2014, 16:08:48) [MSC v.1500 64 bit (AMD64)] on win32
                            Type "help", "copyright", "credits" or "license" for more information.
                            >>>
                            ```
                        </script>
                    </section>
                    <section data-markdown>
                        <script type="text/template">
                            ## DEMO: Command Prompt

                            <!-- ![Python window](../img/cmd-prompt-py-win.png) -->
                            ```
                            # List feature classes
                            import arcpy
                            arcpy.env.workspace = r"C:\projects\arcpy-scripting-presentation\data\gdb\TourDivide.gdb"
                            arcpy.ListFeatureClasses()
                            ```
                            ```
                            # Add feature class to MXD
                            from arcpy import mapping
                            mxd = mapping.MapDocument(r"C:\projects\arcpy-scripting-presentation\data\desktop\TourDivide.mxd")
                            df = mapping.ListDataFrames(mxd)[0]
                            arcpy.env.workspace = r"C:\projects\arcpy-scripting-presentation\data\gdb\TourDivide.gdb"
                            lyr = mapping.Layer("Trail")
                            mapping.AddLayer(df, lyr, "TOP")
                            mxd.saveACopy(r"C:\Temp\TourDivideTrail.mxd")
                            del mxd, lyr
                            ```
                            Note:
                            Don't need to open ArcGIS!
                        </script>
                    </section>
                    <section data-markdown>
                        <script type="text/template">
                            ## >>> Summary

                            * Quickly execute functions and tools
                            * Great way to experiment with syntax
                            * Not good for multiple line programs
                            * Gateway to scripting

                        </script>
                    </section>
                    <section data-markdown>
                        <script type="text/template">
                            ## Bonus!

                            * Python
                                * Importing modules
                                * String, int and list data types
                                * Functions
                            * ArcPy
                                * arcpy.env.workspace & arcpy.env.scratchFolder
                                * arcpy.mapping & arcpy.mp
                                * Running tools and working with Result
                        </script>
                    </section>

                </section>
                <section>
                    <section data-markdown>
                        <script type="text/template">
                            ## Basic Scripting

                        </script>
                    </section>
                    <section data-markdown>
                        <script type="text/template">
                            ## The IDE

                            ![PyCharm](../img/pycharm.png) <!-- .element height="70%" width="70%" -->

                            [Guided Tour](https://www.jetbrains.com/help/pycharm/2017.1/guided-tour-around-pycharm-user-interface.html)

                            Note:
                            Menus & toolbars, Navigation bar, Status bar, Editor, Tool Windows
                        </script>
                    </section>
                    <section data-markdown>
                        <script type="text/template">
                            ## PyCharm setup

                            * Launch to create a new project
                            * Configure a Python interpreter
                                * File-->Settings-->Project:Foo
                                ![img](../img/PyCharmInterpreter.png)
                            * Make it your own File
                                * File-->Settings
                            * [Quick Start Guide](https://www.jetbrains.com/help/pycharm/2017.1/quick-start-guide.html)
                        </script>
                    </section>
                    <section data-markdown>
                        <script type="text/template">
                            ## Create and execute a script

                            1. Create a python file
                            1. Add some code
                            1. Run
                                * From the IDE
                                * From a terminal

                            ```
                            import arcpy

                            arcpy.AddMessage("Hello ArcPy!")
                            ```

                            [Creating and running scripts](https://www.jetbrains.com/help/pycharm/2017.1/creating-and-running-your-first-python-project.html)
                            <!-- .element: class="stretch" -->
                        </script>
                    </section>
                    <section data-markdown>
                        <script type="text/template">
                            ## Modules

                            * Define variables, functions, and classes
                            * Can be imported by another module
                            * Can be executed as a script

                            ```
                            import arcpy

                            def say_hello():
                                arcpy.AddMessage("Hello ArcPy")

                            if __name__ == "__main__":
                                # Execute only if run as a script
                                # __name__ will be set to module name when imported
                                say_hello()
                            ```
                        </script>
                    </section>
                </section>
                <section>
                    <section data-markdown>
                        <script type="text/template">
                            ## Passing Script Parameters

                            * Append parameters
                            * Separate parameers by spaces
                            * Quote values containing spaces

                            ```
                            C:\Temp> python test.py param0 "param 1"
                            ```
                        </script>
                    </section>
                    <section data-markdown>
                        <script type="text/template">
                            ## Retrieving Script Parameters

                            * Use [GetParameterAsText(index)](http://desktop.arcgis.com/en/arcmap/latest/analyze/arcpy-functions/getparameterastext.htm) function
                            * Gets the specified parameter as a text string by its index position from the list of parameters

                            ```
                            a = arcpy.GetParameterAsText(0)
                            b = arcpy.GetParameterAsText(1)
                            ```
                        </script>
                    </section>
                    <section data-markdown>
                        <script type="text/template">
                            ## Parameters Demo

                        </script>
                    </section>
                </section>
                <section>
                    <section data-markdown>
                        <script type="text/template">
                            ## Python Toolbox

                            * Similar to a toolbox (.tbx) except...
                            * Defined in a .pyt file
                            * Contains one or more tools
                            * Create in ArcMap
                                * Right-click folder-->New-->Python Toolbox
                            * Create outside of ArcMap
                                * Copy the [template](http://desktop.arcgis.com/en/arcmap/latest/analyze/creating-tools/a-template-for-python-toolboxes.htm) into a .pyt file

                        </script>
                    </section>
                    <section data-markdown>
                        <script type="text/template">
                            ## The Template

                            Consists of a **Toolbox** and **Tool** class

                            ```
                            import arcpy

                            class Toolbox(object):
                                def __init__(self):
                                    """Define the toolbox (the name of the toolbox is the name of the
                                    .pyt file)."""
                                    self.label = "Toolbox"
                                    self.alias = ""

                                    # List of tool classes associated with this toolbox
                                    self.tools = [Tool]


                            class Tool(object):
                                def __init__(self):
                                    """Define the tool (tool name is the name of the class)."""
                                    self.label = "Tool"
                                    self.description = ""
                                    self.canRunInBackground = False

                                def getParameterInfo(self):
                                    """Define parameter definitions"""
                                    params = None
                                    return params

                                def isLicensed(self):
                                    """Set whether tool is licensed to execute."""
                                    return True

                                def updateParameters(self, parameters):
                                    """Modify the values and properties of parameters before internal
                                    validation is performed.  This method is called whenever a parameter
                                    has been changed."""
                                    return

                                def updateMessages(self, parameters):
                                    """Modify the messages created by internal validation for each tool
                                    parameter.  This method is called after internal validation."""
                                    return

                                def execute(self, parameters, messages):
                                    """The source code of the tool."""
                                    return
                            ```
                        </script>
                    </section>
                    <section data-markdown>
                        <script type="text/template">
                            ## Separation

                            * Separate toolbox and individual tools into modules
                                * *MyToolbox.pyt*, *MyTool.py*, *MyOtherTool.py*...
                            * Makes debugging possible
                            * Organize your code into packages
                            * Ubiquitous!
                                * Run as a standalone script
                                * Utilize in other modules
                                * Include in Toolboxes

                        </script>
                    </section>
                    <section data-markdown>
                        <script type="text/template">
                            ## Define a Tool

                            mytool.py

                            ```
                            import arcpy

                            class MyTool(object):
                                def __init__(self):
                                    """Define the tool (tool name is the name of the class)."""
                                    self.label = "Tool"
                                    self.description = ""
                                    self.canRunInBackground = False

                                def getParameterInfo(self):
                                    """Define parameter definitions"""
                                    params = None
                                    return params

                                def isLicensed(self):
                                    """Set whether tool is licensed to execute."""
                                    return True

                                def updateParameters(self, parameters):
                                    """Modify the values and properties of parameters before internal
                                    validation is performed.  This method is called whenever a parameter
                                    has been changed."""
                                    return

                                def updateMessages(self, parameters):
                                    """Modify the messages created by internal validation for each tool
                                    parameter.  This method is called after internal validation."""
                                    return

                                def execute(self, parameters, messages):
                                    """The source code of the tool."""
                                    return
                            ```
                        </script>
                    </section>
                    <section data-markdown>
                        <script type="text/template">
                            ## Toolbox

                            mytoolbox.pyt

                            ```
                            # Import all tools
                            from mytool import MyTool

                            # Must be named Toolbox!
                            class Toolbox(object):
                                def __init__(self):
                                """Define the toolbox (the name of the toolbox is the name of the
                                .pyt file)."""
                                    self.label = "Toolbox"
                                    self.alias = ""

                                    # List of tool classes associated with this toolbox
                                    self.tools = [MyTool]
                            ```
                        </script>
                    </section>
                    <section data-markdown>
                        <script type="text/template">
                            ## Tool Updates

                            > When a Python toolbox is refreshed, only the Python toolbox file itself is refreshed; any modules that are imported within the toolbox are not. To reload a module from within a Python toolbox, Python's reload function can be temporarily added.

                            1. Restart ArcMap
                            1. Use reload(*module*)

                            ```
                            reload(MyTool)
                            ```
                        </script>
                    </section>
                    <section data-markdown>
                        <script type="text/template">
                            ## Demo

                        </script>
                    </section>
                </section>
                <section>
                    <section data-markdown>
                        <script type="text/template">
                            ## Scheduled Tasks

                            Automate execution of Python scripts
                            ![task scheduler](../img/TaskScheduler.png) <!-- .element height="75%" width="75%" -->

                        </script>
                    </section>
                    <section data-markdown>
                        <script type="text/template">
                            ## Windows Task Scheduler

                            * Create a Basic Task
                            * Specify the Python script you want to run
                            * Define parameters to pass
                            * Determine when you want to run
                                * Run once or recurring
                            * [Tutorial](https://blogs.esri.com/esri/arcgis/2013/07/30/scheduling-a-scrip/)
                        </script>
                    </section>
                    <section data-markdown>
                        <script type="text/template">
                            ## Scheduled Task Demo
                        </script>
                    </section>
                </section>
                <section>
                    <section data-markdown>
                        <script type="text/template">
                            ## Debugging

                            * Use *print()* and *arcpy.AddMessage()*
                                * Not efficient
                                * Makes for messy code
                            * Use an IDE with a debugger
                                * Be a ninja
                                * You can't debug from ArcMap
                        </script>
                    </section>
                    <section data-markdown>
                        <script type="text/template">
                            ## Debugging tasks

                            * Set a break point
                            * Step through your code
                            * Watch values
                            * [Debugging your first app](https://www.jetbrains.com/help/pycharm/2017.1/debugging-your-first-python-application.html)
                        </script>
                    </section>
                    <section data-markdown>
                        <script type="text/template">
                            ## Debugging Demo
                        </script>
                    </section>
                </section>
                <section>
                    <section data-markdown>
                        <script type="text/template">
                            ## Exception Handling

                            * Errors happen :(

                            ```
                            try:
                                # your perfect code
                            except Exception:
                                # handle your code that wasn't so perfect
                            finally:
                                # guaranteed to run when included
                            ```
                            [Error Handling With Python](http://desktop.arcgis.com/en/arcmap/latest/analyze/python/error-handling-with-python.htm)
                        </script>
                    </section>
                    <section data-markdown>
                        <script type="text/template">
                            ## Separate GP and Python Errors

                            ```
                            import arcpy
                            import sys
                            import traceback

                            try:
                                # Execute some GP tool
                                # Invoke some other Python function
                            except arcpy.ExecuteError:
                                # Handle GP errors
                                # Get the tool error messages
                                msgs = arcpy.GetMessages(2)

                                # Return tool error messages for use with a script tool
                                arcpy.AddError(msgs)

                                # Print tool error messages for use in Python/PythonWin
                                print(msgs)
                            except:
                                # Handlen non-GP errors
                                # Get the traceback object
                                tb = sys.exc_info()[2]
                                tbinfo = traceback.format_tb(tb)[0]

                                # Concatenate information together concerning the error into a message string
                                pymsg = "PYTHON ERRORS:\nTraceback info:\n" + tbinfo + "\nError Info:\n" + str(sys.exc_info()[1])
                                msgs = "ArcPy ERRORS:\n" + arcpy.GetMessages(2) + "\n"

                                # Return python error messages for use in script tool or Python Window
                                arcpy.AddError(pymsg)
                                arcpy.AddError(msgs)

                                # Print Python error messages for use in Python / Python Window
                                print(pymsg)
                                print(msgs)
                            ```
                        </script>
                    </section>
                </section>
                <section data-markdown>
                    <script type="text/template">
                        ## End
                    </script>
                </section>
			</div>
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>
			// More info https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				history: true,

				// More info https://github.com/hakimel/reveal.js#dependencies
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});
		</script>
	</body>
</html>
